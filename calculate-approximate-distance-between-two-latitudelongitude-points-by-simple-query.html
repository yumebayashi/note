<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Calculate approximate distance between two latitude/longitude points by simple query &mdash; yumebayashi's note</title>
  <meta name="author" content="yumebayashi">






  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="http://yumebayashi.github.io/note/favicon.png" rel="icon">

  <link href="http://yumebayashi.github.io/note/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://yumebayashi.github.io/note/">yumebayashi's note</a></h1>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
</ul>

<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="yumebayashi.github.io/note">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
      <li><a href="http://yumebayashi.github.io/note/pages/profile.html">Profile</a></li>
      <li class="active">
        <a href="http://yumebayashi.github.io/note/category/tech.html">Tech</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
    <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Calculate approximate distance between two latitude/longitude points by simple query</h1>
    <p class="meta">
<time datetime="2016-05-11T00:00:00+09:00" pubdate>水 11 5月 2016</time>    </p>
</header>

  <div class="entry-content"><ul>
<li>make initial data set</li>
</ul>
<div class="highlight"><pre><span></span>CREATE TABLE tmp_test (
   name character varying(255),
   lat1 numeric(8,5),
   lng1 numeric(8,5),
   lat2 numeric(8,5),
   lng2 numeric(8,5)
)
</pre></div>


<div class="highlight"><pre><span></span>INSERT INTO tmp_test VALUES
(&#39;tokyo-shinjuku&#39;,35.680605, 139.767351,35.689862,139.700253);
</pre></div>


<div class="highlight"><pre><span></span>select * from tmp_test ;
      name      |   lat1   |   lng1    |   lat2   |   lng2
----------------+----------+-----------+----------+-----------
 tokyo-shinjuku | 35.68061 | 139.76735 | 35.68986 | 139.70025
</pre></div>


<h3>plan</h3>
<ul>
<li>consider the Earth as sphere</li>
<li>calculate m/degree for each lat/lng</li>
<li>calculate the distance of each directions</li>
<li>
<p>calculate the distance by Pythagorean theorem</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Earth_radius">Earth radius</a><br />
R : 6,371km = 6371000m  </p>
</li>
</ul>
<p>Calculating the distance of latitude direction is simple.
</p>
<div class="math">$$ \frac{2\pi R}{360} abs(lat1 - lat2)  $$</div>
<p>Calculating the distance of longitude direction is a bit complicated.<br />
Radius varies by its latitude.<br />
<img src="/images/explain.png" width="300px"><br />
I fix the radius by the middle point of two latitudes.</p>
<div class="math">$$ \frac{2\pi}{360} Rcos(\frac{\frac{(lat1 + lat2)}{2}\pi}{180}) abs(lng1 -lng2) $$</div>
<p>then apply Pythagorean theorem
</p>
<div class="math">$$  \sqrt{(\frac{2\pi R}{360} (lat1 - lat2))^2 + (\frac{2\pi}{360} Rcos(\frac{\frac{(lat1 + lat2)}{2}\pi}{180}) (lng1 -lng2))^2} $$</div>
<p>
↓
</p>
<div class="math">$$ \frac{2\pi R}{360} \sqrt{(lat1 - lat2)^2 +  (cos(\frac{\frac{(lat1 + lat2)}{2}\pi}{180}) (lng1 -lng2))^2} $$</div>
<div class="highlight"><pre><span></span>select *, 2 * pi() * 6371000 / 360 * sqrt(power((lat1-lat2),2) + power(cos((lat1 + lat2) / 2 * pi() /180) * (lng1-lng2),2)) as distance from tmp_test;
</pre></div>


<div class="highlight"><pre><span></span>      name      |   lat1   |   lng1    |   lat2   |   lng2    |     distance
----------------+----------+-----------+----------+-----------+------------------
 tokyo-shinjuku | 35.68061 | 139.76735 | 35.68986 | 139.70025 | 6146.88718108597
</pre></div>


<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></div>
        <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        yumebayashi
    </span>
  </span>
<time datetime="2016-05-11T00:00:00+09:00" pubdate>水 11 5月 2016</time>  <span class="categories">
    <a class='category' href='http://yumebayashi.github.io/note/category/tech.html'>tech</a>
  </span>
  <span class="categories">
    <a class="category" href="http://yumebayashi.github.io/note/tag/sql.html">sql</a>  </span>
</p> <div class="sharing">
</div>        </footer>
        <div class="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
            var disqus_identifier = "calculate-approximate-distance-between-two-latitudelongitude-points-by-simple-query.html";
            (function() {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = 'http://yumebayashisnote.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
            </script>
        </div>
    </article>
</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://yumebayashi.github.io/note/copy-s3-to-redshift-the-difference-between-delimiter-and-csv.html">Copy S3 to Redshift, the difference between delimiter ',' and CSV</a>
      </li>
      <li class="post">
          <a href="http://yumebayashi.github.io/note/export-results-with-csv-files-with-mysql-postgres.html">Export results with CSV files with MySQL, Postgres</a>
      </li>
      <li class="post">
          <a href="http://yumebayashi.github.io/note/chrome-custom-search-setting.html">Chrome Custom Search Setting</a>
      </li>
      <li class="post">
          <a href="http://yumebayashi.github.io/note/install-mecab.html">Install Mecab</a>
      </li>
      <li class="post">
          <a href="http://yumebayashi.github.io/note/install-gradle.html">Install Gradle</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://yumebayashi.github.io/note/category/tech.html">tech</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://yumebayashi.github.io/note/tag/redshift.html">redshift</a>,    <a href="http://yumebayashi.github.io/note/tag/chrome.html">chrome</a>,    <a href="http://yumebayashi.github.io/note/tag/query.html">query</a>,    <a href="http://yumebayashi.github.io/note/tag/mysql.html">mysql</a>,    <a href="http://yumebayashi.github.io/note/tag/s3.html">s3</a>,    <a href="http://yumebayashi.github.io/note/tag/eyetribe.html">eyetribe</a>,    <a href="http://yumebayashi.github.io/note/tag/postgres.html">postgres</a>,    <a href="http://yumebayashi.github.io/note/tag/shell.html">shell</a>,    <a href="http://yumebayashi.github.io/note/tag/gradle.html">gradle</a>,    <a href="http://yumebayashi.github.io/note/tag/script.html">script</a>,    <a href="http://yumebayashi.github.io/note/tag/java.html">java</a>,    <a href="http://yumebayashi.github.io/note/tag/sql.html">sql</a>,    <a href="http://yumebayashi.github.io/note/tag/gadget.html">gadget</a>,    <a href="http://yumebayashi.github.io/note/tag/q.html">q</a>,    <a href="http://yumebayashi.github.io/note/tag/python.html">python</a>,    <a href="http://yumebayashi.github.io/note/tag/mecab.html">mecab</a>,    <a href="http://yumebayashi.github.io/note/tag/opencv.html">opencv</a>,    <a href="http://yumebayashi.github.io/note/tag/narrativeclip.html">narrativeclip</a>  </section>



</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2016&ndash;2017  yumebayashi &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="http://yumebayashi.github.io/note/theme/js/modernizr-2.0.js"></script>
  <script src="http://yumebayashi.github.io/note/theme/js/ender.js"></script>
  <script src="http://yumebayashi.github.io/note/theme/js/octopress.js" type="text/javascript"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-56655645-8']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-56655645-8');
    ga('send', 'pageview');
</script>
  <script type="text/javascript">
    var disqus_shortname = 'yumebayashisnote';
    var disqus_identifier = '/calculate-approximate-distance-between-two-latitudelongitude-points-by-simple-query.html';
    var disqus_url = 'http://yumebayashi.github.io/note/calculate-approximate-distance-between-two-latitudelongitude-points-by-simple-query.html';
    var disqus_title = 'Calculate approximate distance between two latitude/longitude points by simple query';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
</body>
</html>